import numpy as np
import matplotlib.pyplot as plt

# --- ШАГ 1: Ввод данных ---
print("=== Построение калибровочного графика: перемещение трубки Пито ===")

# Задаем данные измерений (шаги двигателя -> смещение в см)
steps = [0, 1500]          # Количество шагов двигателя
displacement_cm = [0, 8.35]  # Перемещение трубки Пито в сантиметрах

# --- ШАГ 2: Построение графика ---
plt.figure(figsize=(10, 7))  # Создаем фигуру размером 10x7 дюймов

# Отображаем точки измерения как звёздочки
plt.scatter(
    steps,                 # Ось X: количество шагов
    displacement_cm,       # Ось Y: перемещение в см
    color='#801FFF',          # Цвет точек
    marker='*',            # Форма маркера — звезда
    s=100,                 # Размер маркера
    label='Измерения',      # Подпись для легенды
    zorder=5  # Поверхность: точки поверх сетки
)

# --- Линейная аппроксимация ---
# Находим коэффициенты прямой: displacement = k * steps + b
k, b = np.polyfit(steps, displacement_cm, 1)  # Метод наименьших квадратов

# Генерируем плавный диапазон шагов для построения линии
steps_for_plot = np.linspace(0, max(steps), 100)  # 100 точек от 0 до максимального шага
displacement_fit = k * steps_for_plot + b        # Вычисляем соответствующее перемещение

# Рисуем аппроксимирующую прямую оранжевым цветом, сплошной линией
plt.plot(
    steps_for_plot,           # Ось X: шаги
    displacement_fit,         # Ось Y: рассчитанное перемещение
    color='#D184FF',           # Цвет линии
    linewidth=2,              # Толщина линии
    label=f'X = {k:.1e} * step [см]'  # Подпись с формулой (в см!)
)

# --- Настройка внешнего вида графика ---
plt.title('Калибровочный график\nзависимости перемещения трубки Пито от шага двигателя', fontsize=14, pad=20)
plt.xlabel('Количество шагов', fontsize=12)               # Название оси X
plt.ylabel('Перемещение трубки Пито [см]', fontsize=12)   # Название оси Y

# Включение основной и дополнительной (минорной) сетки
plt.grid(True, which='major', alpha=0.7, linewidth=1)     # Основная сетка
plt.grid(True, which='minor', alpha=0.4, linewidth=0.8)   # Минорная сетка
plt.minorticks_on()  # Включаем минорные деления

# Управление частотой меток на осях (делаем их чаще)
# plt.xticks(np.arange(0, max(steps)+100, 100))  # Шаг 100 по оси X
# plt.yticks(np.arange(0, max(displacement_cm)+1, 0.5))  # Шаг 0.5 по оси Y

# Добавляем легенду
plt.legend()

# Автоматическая подгонка полей
plt.tight_layout()

# --- ШАГ 3: Отображение графика ---
plt.show()

# --- ШАГ 4: Вывод результатов ---
print("\n=== Результаты калибровки перемещения ===")
print(f"Уравнение: X = {k:.6f} * step + {b:.6f} [см]")
print(f"Коэффициент пропорциональности: {k:.6f} см/шаг")
print(f"Сдвиг (ошибка нуля): {b:.6f} см")